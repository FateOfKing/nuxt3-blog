<!DOCTYPE html>
<html  data-head-attrs="">

<head >
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="head:count" content="2"><link rel="modulepreload" href="/_nuxt/entry-298ea703.mjs" as="script" crossorigin><link rel="preload" href="/_nuxt/entry.20072ffb.css" as="style"><link rel="modulepreload" href="/_nuxt/_id_-b3d49c8b.mjs" as="script" crossorigin><link rel="modulepreload" href="/_nuxt/article-4d80814c.mjs" as="script" crossorigin><link rel="modulepreload" href="/_nuxt/index-ed8b9815.mjs" as="script" crossorigin><link rel="prefetch" href="/_nuxt/avatar.a4306ac7.jpg"><link rel="prefetch" as="script" href="/_nuxt/archive-21df8f86.mjs"><link rel="prefetch" as="script" href="/_nuxt/pageContainer-c6eeb7c3.mjs"><link rel="prefetch" as="script" href="/_nuxt/index-27e32ad6.mjs"><link rel="prefetch" as="script" href="/_nuxt/life-2a467d13.mjs"><link rel="prefetch" as="script" href="/_nuxt/skillSample-d0858c4e.mjs"><link rel="stylesheet" href="/_nuxt/entry.20072ffb.css">
</head>

<body  data-head-attrs="">
  <div id="__nuxt"><!--[--><!--[--><div class="bg-gray-page-bg-color h-screen" data-v-f59aa03c><div class="flex justify-center bg-black-bg-color" data-v-f59aa03c data-v-3cc81b26><div class="flex container h-[3.5rem] leading-[3.5rem] text-white px-5" data-v-3cc81b26><a href="/" class="site-title" data-v-3cc81b26>CarleBlog.com</a><span class="head-title-container" data-v-3cc81b26><a href="/" class="head-title" data-v-3cc81b26>博客首页</a></span><span class="head-title-container" data-v-3cc81b26><a href="/archive" class="head-title" data-v-3cc81b26>归档文章</a></span><span class="head-title-container" data-v-3cc81b26><a href="/skillSample" class="head-title" data-v-3cc81b26>技能展示</a></span></div></div><div class="container h-full mx-auto main clear-fix px-10" data-v-f59aa03c><div class="center bg-white mt-5 p-5" data-v-f59aa03c><div data-v-f59aa03c><div class="text-black text-xl font-bold text-center" data-v-f59aa03c>weex笔记（10）weexstudio调试-监听本地编译文件并自动刷新界面</div><div class="text-sm text-gray-400 text-center mt-3" data-v-f59aa03c>2020-7-17</div><div data-v-f59aa03c><p><a href="https://weex.apache.org/zh/tools/ide.html">weexStudio下载地址</a></p>
<ol>
<li><p>安装weexlistener
安装命令<code>npm install weexlistener -g</code>
weexlistener用于监听本地文件，并建立一个websocket。端口号固定为29998。
也可以自己写代码监听这个端口</p>
</li>
<li><p>安装concurrently
在工程目录下
安装命令 <code>npm install concurrently -g</code>
用于npm同时执行两个命令</p>
</li>
<li><p>在安卓或者iOS代码中监听本地websocket端口29998
iOS代码：</p>
<pre><code>NSURL *socketURL = [NSURL URLWithString:[NSString stringWithFormat:@<span class="hljs-string">&quot;ws://%@:%@&quot;</span>, ip, @<span class="hljs-string">&quot;29998&quot;</span>]];
 <span class="hljs-built_in">self</span>.hotReloadSocket = <span class="hljs-string">[[SRWebSocket alloc] initWithURL:socketURL protocols:@[@&quot;echo-protocol&quot;]]</span>;
 <span class="hljs-built_in">self</span>.hotReloadSocket.delegate = <span class="hljs-built_in">self</span>;
 [<span class="hljs-built_in">self</span>.hotReloadSocket <span class="hljs-built_in">open</span>];
</code></pre>
<p>在receive回调方法中接受参数
```
 if ([@&quot;refresh&quot; isEqualToString:message]) {</p>
<pre><code> UInt64 recordTime <span class="hljs-operator">=</span> [[NSDate date] timeIntervalSince1970]*<span class="hljs-number">1000</span><span class="hljs-comment">;</span>
 if(recordTime-_lastrefresh&gt;<span class="hljs-number">300</span>)
 {
     _lastrefresh<span class="hljs-operator">=</span>recordTime<span class="hljs-comment">;</span>
     DBWXBaseViewController *baseVC <span class="hljs-operator">=</span> self.navigationController.viewControllers.lastObject<span class="hljs-comment">;</span>
     [baseVC refresh]<span class="hljs-comment">;</span>
 }
 
</code></pre>
<p> }</p>
</li>
</ol>
<pre><code>
<span class="hljs-number">4.</span> 配置weex工程 package.json
修改script语句`&quot;ide:preview&quot;: &quot;concurrently \&quot;npm <span class="hljs-keyword">start</span>\&quot; \&quot;weexls <span class="hljs-keyword">start</span>\&quot;&quot;`

<span class="hljs-number">5.</span> 运行weexstudio 
编译结束后，每次保存都会自动刷新手机端界面
</code></pre>
</div></div></div></div></div><!--]--><!--]--></div><script>window.__NUXT__={data:{pinia:{},urql:{"2323063251":{data:"{\"getArticle\":{\"id\":53,\"title\":\"weex笔记（10）weexstudio调试-监听本地编译文件并自动刷新界面\",\"article_content\":\"[weexStudio下载地址](https:\u002F\u002Fweex.apache.org\u002Fzh\u002Ftools\u002Fide.html)\\n1. 安装weexlistener\\n安装命令`npm install weexlistener -g`\\nweexlistener用于监听本地文件，并建立一个websocket。端口号固定为29998。\\n也可以自己写代码监听这个端口\\n2. 安装concurrently\\n在工程目录下\\n安装命令 `npm install concurrently -g`\\n用于npm同时执行两个命令\\n3. 在安卓或者iOS代码中监听本地websocket端口29998\\niOS代码：\\n```\\nNSURL *socketURL = [NSURL URLWithString:[NSString stringWithFormat:@\\\"ws:\u002F\u002F%@:%@\\\", ip, @\\\"29998\\\"]];\\n    self.hotReloadSocket = [[SRWebSocket alloc] initWithURL:socketURL protocols:@[@\\\"echo-protocol\\\"]];\\n    self.hotReloadSocket.delegate = self;\\n    [self.hotReloadSocket open];\\n```\\n在receive回调方法中接受参数\\n```\\n if ([@\\\"refresh\\\" isEqualToString:message]) {\\n        \\n        UInt64 recordTime = [[NSDate date] timeIntervalSince1970]*1000;\\n        if(recordTime-_lastrefresh\u003E300)\\n        {\\n            _lastrefresh=recordTime;\\n            DBWXBaseViewController *baseVC = self.navigationController.viewControllers.lastObject;\\n            [baseVC refresh];\\n        }\\n        \\n    }\\n```\\n\\n4. 配置weex工程 package.json\\n修改script语句`\\\"ide:preview\\\": \\\"concurrently \\\\\\\"npm start\\\\\\\" \\\\\\\"weexls start\\\\\\\"\\\"`\\n\\n5. 运行weexstudio \\n编译结束后，每次保存都会自动刷新手机端界面\\n\",\"addTime\":1594964726,\"view_content\":0,\"type_id\":\"4\",\"__typename\":\"ArticleDto\"}}"}}},state:{error:null},_errors:{},serverRendered:true,config:{public:{},app:{baseURL:"\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:""}},__URQL_DATA__:{}}</script><script type="module" src="/_nuxt/entry-298ea703.mjs" crossorigin></script><script type="module" src="/_nuxt/_id_-b3d49c8b.mjs" crossorigin></script>
</body>

</html>